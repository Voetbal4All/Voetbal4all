<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Artikel laden... - Voetbal4All</title>
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="" id="og-url">
    <meta property="og:title" content="" id="og-title">
    <meta property="og:description" content="" id="og-description">
    <meta property="og:image" content="" id="og-image">
    <meta property="og:site_name" content="Voetbal4All">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="" id="twitter-url">
    <meta property="twitter:title" content="" id="twitter-title">
    <meta property="twitter:description" content="" id="twitter-description">
    <meta property="twitter:image" content="" id="twitter-image">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            line-height: 1.6;
        }

        /* Navigation */
        nav {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-logo {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: opacity 0.3s;
        }

        .nav-links a:hover {
            opacity: 0.8;
        }

        /* Live Banner */
        .live-banner {
            background: linear-gradient(90deg, #ff6b6b, #ee5a6f);
            color: white;
            padding: 0.75rem;
            text-align: center;
            font-weight: 600;
            display: none;
            animation: pulse 2s infinite;
        }

        .live-banner.active {
            display: block;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.9; }
        }

        .live-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            margin-right: 8px;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Article Container */
        .article-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .article-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .article-header {
            padding: 2rem 2rem 1rem 2rem;
        }

        .article-meta {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .article-type {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .article-country {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.25rem 0.75rem;
            background: #f0f0f0;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .article-date {
            color: #666;
            font-size: 0.9rem;
        }

        .article-title {
            font-size: 2rem;
            font-weight: 800;
            color: #1a1a1a;
            line-height: 1.3;
            margin-bottom: 1rem;
        }

        .article-caption {
            color: #666;
            font-size: 0.95rem;
            margin-bottom: 1.5rem;
        }

        .article-standfirst {
            font-size: 1.15rem;
            color: #333;
            line-height: 1.7;
            font-weight: 500;
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .article-image-container {
            width: 100%;
            max-height: 500px;
            overflow: hidden;
            background: #f0f0f0;
        }

        .article-image {
            width: 100%;
            height: auto;
            display: block;
        }

        .article-body {
            padding: 2rem;
        }

        .article-body p {
            margin-bottom: 1.5rem;
            font-size: 1.05rem;
            line-height: 1.8;
            color: #333;
        }

        .article-body p:last-child {
            margin-bottom: 0;
        }

        /* Share Buttons */
        .share-section {
            padding: 2rem;
            border-top: 2px solid #f0f0f0;
        }

        .share-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #333;
        }

        .share-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .share-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
            text-decoration: none;
            color: white;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }

        .share-btn:active {
            transform: translateY(0);
        }

        .btn-facebook {
            background: #1877f2;
        }

        .btn-twitter {
            background: #1da1f2;
        }

        .btn-whatsapp {
            background: #25d366;
        }

        .btn-copy {
            background: #6c757d;
        }

        .btn-copy.copied {
            background: #28a745;
        }

        /* Related Articles */
        .related-section {
            max-width: 1200px;
            margin: 3rem auto;
            padding: 0 1rem;
        }

        .related-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 2rem;
            text-align: center;
            color: #1a1a1a;
        }

        .related-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
        }

        .related-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            text-decoration: none;
            color: inherit;
        }

        .related-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .related-card-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background: #f0f0f0;
        }

        .related-card-content {
            padding: 1.5rem;
        }

        .related-card-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 0.75rem;
            line-height: 1.4;
        }

        .related-card-meta {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #666;
            font-size: 0.85rem;
        }

        /* Ad Container */
        .ad-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .ad-block {
            background: #f9f9f9;
            border: 2px dashed #e0e0e0;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            min-height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Loading & Error States */
        .loading {
            text-align: center;
            padding: 4rem 2rem;
            color: #666;
        }

        .error {
            max-width: 600px;
            margin: 4rem auto;
            padding: 2rem;
            background: #fee;
            border: 2px solid #fcc;
            border-radius: 12px;
            color: #c33;
            text-align: center;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-content {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-links {
                gap: 1rem;
            }

            .article-title {
                font-size: 1.5rem;
            }

            .article-header {
                padding: 1.5rem 1.5rem 1rem 1.5rem;
            }

            .article-body {
                padding: 1.5rem;
            }

            .share-section {
                padding: 1.5rem;
            }

            .related-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-content">
            <a href="/" class="nav-logo">
                <span>‚öΩ</span>
                <span>Voetbal4All</span>
            </a>
            <ul class="nav-links">
                <li><a href="/">Home</a></li>
                <li><a href="/artikels.html">Nieuws</a></li>
                <li><a href="/live.html">Live</a></li>
            </ul>
        </div>
    </nav>

    <!-- Live Banner -->
    <div class="live-banner" id="live-banner">
        <span class="live-dot"></span>
        <span id="live-text">LIVE: Bekijk de wedstrijd nu!</span>
    </div>

    <!-- Article Content -->
    <div class="article-container">
        <div id="article-content">
            <div class="loading">
                <h2>Artikel laden...</h2>
            </div>
        </div>
    </div>

    <!-- Ad Block 1 -->
    <div class="ad-container">
        <div class="ad-block">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-YOUR_PUBLISHER_ID"
                 data-ad-slot="ARTICLE_AD_SLOT_1"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
        </div>
    </div>

    <!-- Related Articles -->
    <div class="related-section">
        <h2 class="related-title">Gerelateerde Artikelen</h2>
        <div class="related-grid" id="related-articles">
            <!-- Related articles will be inserted here -->
        </div>
    </div>

    <!-- Ad Block 2 -->
    <div class="ad-container">
        <div class="ad-block">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-YOUR_PUBLISHER_ID"
                 data-ad-slot="ARTICLE_AD_SLOT_2"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
        </div>
    </div>

    <script>
        const API_BASE = 'https://api.voetbal4all.be';

        // Utility functions
        function norm(s) {
            return (s || '').toLowerCase().trim();
        }

        function safe(s) {
            return s || '';
        }

        function getCountryCode(article) {
            // 1. Direct country field
            if (article.country) {
                const c = norm(article.country);
                if (c === 'be' || c === 'belgium' || c === 'belgie' || c === 'belgi√´') return 'BE';
                if (c === 'nl' || c === 'netherlands' || c === 'nederland') return 'NL';
            }

            // 2. Source/Feed ID prefix
            const sourceId = norm(safe(article.sourceId || article.feedId));
            if (sourceId.startsWith('be_')) return 'BE';
            if (sourceId.startsWith('nl_')) return 'NL';

            // 3. Publisher/source signals
            const pub = norm(safe(article.publisher || article.source));
            const beSignals = ['sporza', 'hln', 'nieuwsblad', 'hbvl', 'gazet van antwerpen', 'gva', 'vtm', 'vrt', 'standaard'];
            const nlSignals = ['nos', 'vi.nl', 'vi', 'telegraaf', 'ad.nl', 'ad', 'voetbalzone', 'voetbalprimeur'];
            
            if (beSignals.some(s => pub.includes(s))) return 'BE';
            if (nlSignals.some(s => pub.includes(s))) return 'NL';

            // 4. Default
            return 'INT';
        }

        function getCountryDisplay(country) {
            const map = {
                'BE': { flag: 'üáßüá™', name: 'Belgi√´' },
                'NL': { flag: 'üá≥üá±', name: 'Nederland' },
                'INT': { flag: 'üåç', name: 'Internationaal' }
            };
            return map[country] || map['INT'];
        }

        function cleanTextForUI(text) {
            if (!text) return '';
            
            let cleaned = text;
            
            // Remove "Bron:" or "Source:" segments
            cleaned = cleaned.replace(/\s*[-‚Äî|]\s*(Bron|Source|Publisher)\s*:?\s*[^.]*$/gi, '');
            cleaned = cleaned.replace(/^(Bron|Source|Publisher)\s*:?\s*/gi, '');
            
            // Remove trailing publisher names after separators
            const publishers = [
                'HLN', 'NOS', 'Sporza', 'VRT', 'VTM', 'Nieuwsblad', 'Het Nieuwsblad',
                'Telegraaf', 'De Telegraaf', 'AD\\.nl', 'AD', 'VI\\.nl', 'VI',
                'Voetbalzone', 'Voetbalprimeur', 'Het Laatste Nieuws',
                'De Standaard', 'Gazet van Antwerpen', 'GVA', 'HBVL',
                'Het Belang van Limburg', 'De Morgen'
            ];
            const pubPattern = new RegExp(`\\s*[-‚Äî|]\\s*(${publishers.join('|')})\\s*$`, 'gi');
            cleaned = cleaned.replace(pubPattern, '');
            
            return cleaned.trim();
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 60) return `${diffMins} minuten geleden`;
            if (diffHours < 24) return `${diffHours} uur geleden`;
            if (diffDays < 7) return `${diffDays} dagen geleden`;
            
            return date.toLocaleDateString('nl-NL', { 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric' 
            });
        }

        function getImageUrl(imageUrl) {
            if (!imageUrl) return null;
            if (imageUrl.startsWith('http://') || imageUrl.startsWith('https://')) {
                return imageUrl;
            }
            return `${API_BASE}${imageUrl.startsWith('/') ? '' : '/'}${imageUrl}`;
        }

        function renderArticle(article) {
            const country = getCountryCode(article);
            const countryDisplay = getCountryDisplay(country);
            const category = article.category || 'Nieuws';
            const cleanTitle = cleanTextForUI(article.title);
            const cleanSnippet = cleanTextForUI(article.snippet || article.description || '');
            const imageUrl = getImageUrl(article.image || article.imageUrl);
            
            // Build body paragraphs with cleaning
            let bodyHTML = '';
            if (article.body) {
                const paragraphs = article.body.split('\n').filter(p => p.trim());
                bodyHTML = paragraphs.map(p => `<p>${cleanTextForUI(p)}</p>`).join('');
            }

            const imageHTML = imageUrl ? `
                <div class="article-image-container">
                    <img src="${imageUrl}" alt="${cleanTitle}" class="article-image" onerror="this.parentElement.style.display='none'">
                </div>
            ` : '';

            const currentUrl = window.location.href;
            const shareText = encodeURIComponent(cleanTitle);
            const shareUrl = encodeURIComponent(currentUrl);

            const html = `
                <div class="article-card">
                    <div class="article-header">
                        <div class="article-meta">
                            <span class="article-type">${category}</span>
                            <span class="article-country">
                                <span>${countryDisplay.flag}</span>
                                <span>${countryDisplay.name}</span>
                            </span>
                            <span class="article-date">${formatDate(article.pubDate || article.publishedAt)}</span>
                        </div>
                        <h1 class="article-title">${cleanTitle}</h1>
                        <div class="article-caption">Voetbal4All ¬∑ ${countryDisplay.name}</div>
                        ${cleanSnippet ? `<div class="article-standfirst">${cleanSnippet}</div>` : ''}
                    </div>
                    ${imageHTML}
                    <div class="article-body">
                        ${bodyHTML || '<p>Geen artikelinhoud beschikbaar.</p>'}
                    </div>
                    <div class="share-section">
                        <h3 class="share-title">Deel dit artikel</h3>
                        <div class="share-buttons">
                            <a href="https://www.facebook.com/sharer/sharer.php?u=${shareUrl}" 
                               target="_blank" 
                               class="share-btn btn-facebook">
                                <span>üìò</span>
                                <span>Facebook</span>
                            </a>
                            <a href="https://twitter.com/intent/tweet?text=${shareText}&url=${shareUrl}" 
                               target="_blank" 
                               class="share-btn btn-twitter">
                                <span>üê¶</span>
                                <span>Twitter</span>
                            </a>
                            <a href="https://wa.me/?text=${shareText}%20${shareUrl}" 
                               target="_blank" 
                               class="share-btn btn-whatsapp">
                                <span>üí¨</span>
                                <span>WhatsApp</span>
                            </a>
                            <button class="share-btn btn-copy" id="copy-link-btn">
                                <span>üîó</span>
                                <span id="copy-btn-text">Kopieer link</span>
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('article-content').innerHTML = html;

            // Setup copy button
            const copyBtn = document.getElementById('copy-link-btn');
            if (copyBtn) {
                copyBtn.addEventListener('click', () => {
                    navigator.clipboard.writeText(currentUrl).then(() => {
                        const btnText = document.getElementById('copy-btn-text');
                        if (btnText) {
                            btnText.textContent = 'Gekopieerd!';
                            copyBtn.classList.add('copied');
                            setTimeout(() => {
                                btnText.textContent = 'Kopieer link';
                                copyBtn.classList.remove('copied');
                            }, 2000);
                        }
                    }).catch(err => {
                        console.error('Copy failed:', err);
                    });
                });
            }

            // Update page metadata
            updateMetadata(article, cleanTitle, cleanSnippet, imageUrl, currentUrl);
        }

        function updateMetadata(article, cleanTitle, cleanSnippet, imageUrl, currentUrl) {
            // Page title
            const pageTitle = document.getElementById('page-title');
            if (pageTitle) {
                pageTitle.textContent = `${cleanTitle} - Voetbal4All`;
            }

            // OG tags
            const ogUrl = document.getElementById('og-url');
            const ogTitle = document.getElementById('og-title');
            const ogDesc = document.getElementById('og-description');
            const ogImage = document.getElementById('og-image');

            if (ogUrl) ogUrl.setAttribute('content', currentUrl);
            if (ogTitle) ogTitle.setAttribute('content', cleanTitle);
            if (ogDesc) ogDesc.setAttribute('content', cleanSnippet || cleanTitle);
            if (ogImage && imageUrl) ogImage.setAttribute('content', imageUrl);

            // Twitter tags
            const twitterUrl = document.getElementById('twitter-url');
            const twitterTitle = document.getElementById('twitter-title');
            const twitterDesc = document.getElementById('twitter-description');
            const twitterImage = document.getElementById('twitter-image');

            if (twitterUrl) twitterUrl.setAttribute('content', currentUrl);
            if (twitterTitle) twitterTitle.setAttribute('content', cleanTitle);
            if (twitterDesc) twitterDesc.setAttribute('content', cleanSnippet || cleanTitle);
            if (twitterImage && imageUrl) twitterImage.setAttribute('content', imageUrl);
        }

        function renderRelatedArticles(articles, currentArticleId) {
            const container = document.getElementById('related-articles');
            if (!container) return;

            const related = articles
                .filter(a => a.id !== currentArticleId)
                .slice(0, 6);

            if (related.length === 0) {
                container.innerHTML = '<p style="text-align:center;color:#666;">Geen gerelateerde artikelen gevonden.</p>';
                return;
            }

            const html = related.map(article => {
                const country = getCountryCode(article);
                const countryDisplay = getCountryDisplay(country);
                const cleanTitle = cleanTextForUI(article.title);
                const imageUrl = getImageUrl(article.image || article.imageUrl) || 'https://via.placeholder.com/400x200?text=Voetbal';
                
                return `
                    <a href="/artikel.html?id=${article.id}" class="related-card">
                        <img src="${imageUrl}" alt="${cleanTitle}" class="related-card-image" onerror="this.src='https://via.placeholder.com/400x200?text=Voetbal'">
                        <div class="related-card-content">
                            <h3 class="related-card-title">${cleanTitle}</h3>
                            <div class="related-card-meta">
                                <span>${countryDisplay.flag}</span>
                                <span>${countryDisplay.name}</span>
                                <span>‚Ä¢</span>
                                <span>${formatDate(article.pubDate || article.publishedAt)}</span>
                            </div>
                        </div>
                    </a>
                `;
            }).join('');

            container.innerHTML = html;
        }

        async function loadArticle() {
            try {
                const params = new URLSearchParams(window.location.search);
                const articleId = params.get('id');

                if (!articleId) {
                    throw new Error('Geen artikel ID gevonden in URL');
                }

                // Fetch all articles
                const response = await fetch(`${API_BASE}/api/news?limit=500`);
                if (!response.ok) throw new Error('Kon artikelen niet laden');
                
                const data = await response.json();
                const articles = data.articles || data || [];

                // Find the specific article
                const article = articles.find(a => String(a.id) === String(articleId));
                
                if (!article) {
                    throw new Error('Artikel niet gevonden');
                }

                renderArticle(article);
                renderRelatedArticles(articles, article.id);

                // Initialize AdSense
                if (window.adsbygoogle) {
                    const ads = document.querySelectorAll('.adsbygoogle');
                    ads.forEach(ad => {
                        try {
                            (adsbygoogle = window.adsbygoogle || []).push({});
                        } catch (e) {
                            console.error('AdSense error:', e);
                        }
                    });
                }

            } catch (error) {
                console.error('Error loading article:', error);
                document.getElementById('article-content').innerHTML = `
                    <div class="error">
                        <h2>Fout bij laden van artikel</h2>
                        <p>${error.message}</p>
                        <p><a href="/artikels.html" style="color: #667eea; font-weight: 600;">‚Üê Terug naar overzicht</a></p>
                    </div>
                `;
            }
        }

        // Live banner functionality
        function checkLiveMatches() {
            const banner = document.getElementById('live-banner');
            const text = document.getElementById('live-text');
            
            if (!banner || !text) return;

            fetch(`${API_BASE}/api/live-matches`)
                .then(response => response.json())
                .then(data => {
                    if (data.matches && data.matches.length > 0) {
                        const match = data.matches[0];
                        text.textContent = `LIVE: ${match.homeTeam} vs ${match.awayTeam}`;
                        banner.classList.add('active');
                    }
                })
                .catch(err => console.error('Live matches error:', err));
        }

        // Initialize
        loadArticle();
        checkLiveMatches();
        setInterval(checkLiveMatches, 60000); // Check every minute
    </script>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-YOUR_PUBLISHER_ID"
            crossorigin="anonymous"></script>
</body>
</html>