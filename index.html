<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voetbal4All - Jouw Bron voor Voetbalnieuws</title>
    <meta name="description" content="Volg het laatste voetbalnieuws uit Belgi√´ en Nederland. Livescores, uitslagen, statistieken en meer op Voetbal4All.">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Voetbal4All - Jouw Bron voor Voetbalnieuws">
    <meta property="og:description" content="Volg het laatste voetbalnieuws uit Belgi√´ en Nederland.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://voetbal4all.be">
    <meta property="og:image" content="https://voetbal4all.be/images/og-image.jpg">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        /* Navigation */
        nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: 800;
            color: #667eea;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: #333;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #667eea;
        }

        .nav-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #333;
        }

        /* Live Banner */
        .live-banner {
            background: linear-gradient(90deg, #ff6b6b, #ee5a6f);
            color: white;
            padding: 0.75rem;
            text-align: center;
            font-weight: 600;
            display: none;
            animation: pulse 2s infinite;
        }

        .live-banner.active {
            display: block;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.9; }
        }

        .live-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            margin-right: 8px;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Hero Section */
        .hero {
            text-align: center;
            padding: 4rem 2rem;
            color: white;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .hero p {
            font-size: 1.3rem;
            opacity: 0.95;
            margin-bottom: 2rem;
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 1rem 2rem;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 700;
            font-size: 1.1rem;
            transition: transform 0.3s, box-shadow 0.3s;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: white;
            color: #667eea;
        }

        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        /* Section Titles */
        .section-title {
            font-size: 2rem;
            font-weight: 800;
            color: white;
            margin-bottom: 2rem;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        /* Articles Grid */
        .articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .article-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }

        .article-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.2);
        }

        .article-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .article-content {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .article-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .article-flag {
            font-size: 1.5rem;
        }

        .article-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #1a1a1a;
            line-height: 1.4;
            margin-bottom: 0.75rem;
            flex-grow: 1;
        }

        .article-meta {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #666;
            font-size: 0.9rem;
            margin-top: auto;
        }

        .article-category {
            padding: 0.25rem 0.75rem;
            background: #f0f0f0;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        /* Ad Container */
        .ad-container {
            background: rgba(255,255,255,0.95);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            min-height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 3rem 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* Loading & Error */
        .loading {
            text-align: center;
            padding: 3rem;
            color: white;
            font-size: 1.2rem;
        }

        .error {
            background: rgba(255,255,255,0.95);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            color: #c33;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* Footer */
        footer {
            background: rgba(0,0,0,0.2);
            color: white;
            padding: 2rem;
            text-align: center;
            margin-top: 4rem;
        }

        footer p {
            margin-bottom: 0.5rem;
        }

        footer a {
            color: white;
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-toggle {
                display: block;
            }

            .nav-links {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: white;
                flex-direction: column;
                padding: 1rem;
                box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            }

            .nav-links.active {
                display: flex;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .hero p {
                font-size: 1.1rem;
            }

            .articles-grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 2rem 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <a href="/" class="nav-logo">
                <span>‚öΩ</span>
                <span>Voetbal4All</span>
            </a>
            <button class="nav-toggle" id="nav-toggle">‚ò∞</button>
            <ul class="nav-links" id="nav-links">
                <li><a href="/">Home</a></li>
                <li><a href="/artikels.html">Nieuws</a></li>
                <li><a href="/live.html">Live</a></li>
                <li><a href="/statistieken.html">Statistieken</a></li>
            </ul>
        </div>
    </nav>

    <!-- Live Banner -->
    <div class="live-banner" id="live-banner">
        <span class="live-dot"></span>
        <span id="live-text">LIVE: Bekijk de wedstrijd nu!</span>
    </div>

    <!-- Hero Section -->
    <section class="hero">
        <h1>‚öΩ Welkom bij Voetbal4All</h1>
        <p>Jouw ultieme bron voor voetbalnieuws uit Belgi√´ en Nederland</p>
        <div class="hero-buttons">
            <a href="/live.html" class="btn btn-primary">üî¥ Live Scores</a>
            <a href="/artikels.html" class="btn btn-secondary">üì∞ Alle Nieuws</a>
        </div>
    </section>

    <!-- Latest Articles -->
    <div class="container">
        <h2 class="section-title">üî• Laatste Artikels & Verhalen</h2>
        <div id="articles-container" class="articles-grid">
            <div class="loading">Artikelen laden...</div>
        </div>

        <!-- Ad Block 1 -->
        <div class="ad-container">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-YOUR_PUBLISHER_ID"
                 data-ad-slot="HOME_AD_SLOT_1"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
        </div>

        <div id="articles-container-2" class="articles-grid">
            <!-- More articles will be loaded here -->
        </div>

        <!-- Ad Block 2 -->
        <div class="ad-container">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-YOUR_PUBLISHER_ID"
                 data-ad-slot="HOME_AD_SLOT_2"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <p>&copy; 2024 Voetbal4All. Alle rechten voorbehouden.</p>
        <p><a href="/privacy.html">Privacy</a> | <a href="/contact.html">Contact</a></p>
    </footer>

    <script>
        const API_BASE = 'https://api.voetbal4all.be';
        const IMG_BASE = 'https://api.voetbal4all.be';
        const CACHE_KEY = 'voetbal4all_articles_v2';
        const CACHE_DURATION = 5 * 60 * 1000; // 5 minutes
        const REFRESH_MS = 5 * 60 * 1000; // 5 minutes

        // Utility functions
        function safe(s) {
            return s || '';
        }

        function norm(s) {
            return safe(s).toLowerCase().trim();
        }

        function getCountryCode(article) {
            // 1. Direct country field
            if (article.country) {
                const c = norm(article.country);
                if (c === 'be' || c === 'belgium' || c === 'belgie' || c === 'belgi√´') return 'BE';
                if (c === 'nl' || c === 'netherlands' || c === 'nederland') return 'NL';
            }

            // 2. Source/Feed ID prefix
            const sourceId = norm(safe(article.sourceId || article.feedId));
            if (sourceId.startsWith('be_')) return 'BE';
            if (sourceId.startsWith('nl_')) return 'NL';

            // 3. Publisher/source signals
            const pub = norm(safe(article.publisher || article.source));
            const beSignals = ['sporza', 'hln', 'nieuwsblad', 'hbvl', 'gazet van antwerpen', 'gva', 'vtm', 'vrt', 'standaard'];
            const nlSignals = ['nos', 'vi.nl', 'vi', 'telegraaf', 'ad.nl', 'ad', 'voetbalzone', 'voetbalprimeur'];
            
            if (beSignals.some(s => pub.includes(s))) return 'BE';
            if (nlSignals.some(s => pub.includes(s))) return 'NL';

            // 4. Default
            return 'INT';
        }

        function getCountryFlag(country) {
            const flags = {
                'BE': 'üáßüá™',
                'NL': 'üá≥üá±',
                'INT': 'üåç'
            };
            return flags[country] || '';
        }

        function getImageUrl(article) {
            let imgUrl = '';
            
            if (article.image) {
                if (typeof article.image === 'string') {
                    imgUrl = article.image;
                } else if (article.image.publicPath) {
                    imgUrl = article.image.publicPath;
                }
            } else if (article.imageUrl) {
                imgUrl = article.imageUrl;
            }

            if (!imgUrl) return null;

            // Make relative paths absolute
            if (imgUrl.startsWith('/')) {
                return `${IMG_BASE}${imgUrl}`;
            }

            // Already absolute
            if (imgUrl.startsWith('http://') || imgUrl.startsWith('https://')) {
                return imgUrl;
            }

            // Relative without leading slash
            return `${IMG_BASE}/${imgUrl}`;
        }

        function cleanTitleForUI(title) {
            if (!title) return '';
            
            let cleaned = title;
            
            // Remove trailing publisher names after separators
            const publishers = [
                'HLN', 'NOS', 'Sporza', 'VRT', 'VTM', 'Nieuwsblad', 'Het Nieuwsblad',
                'Telegraaf', 'De Telegraaf', 'AD\\.nl', 'AD', 'VI\\.nl', 'VI',
                'Voetbalzone', 'Voetbalprimeur', 'Het Laatste Nieuws',
                'De Standaard', 'Gazet van Antwerpen', 'GVA', 'HBVL',
                'Het Belang van Limburg', 'De Morgen'
            ];
            const pubPattern = new RegExp(`\\s*[-‚Äî|]\\s*(${publishers.join('|')})\\s*$`, 'gi');
            cleaned = cleaned.replace(pubPattern, '');
            
            return cleaned.trim();
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 60) return `${diffMins}m`;
            if (diffHours < 24) return `${diffHours}u`;
            if (diffDays < 7) return `${diffDays}d`;
            
            return date.toLocaleDateString('nl-NL', { day: 'numeric', month: 'short' });
        }

        function normalizeTitle(title) {
            return norm(title)
                .replace(/[^\w\s]/g, '')
                .replace(/\s+/g, ' ');
        }

        function isFootballRelated(article) {
            const text = norm(`${article.title} ${article.snippet || ''} ${article.description || ''}`);
            const negativeKeywords = [
                'politiek', 'verkiezingen', 'regering', 'minister',
                'economie', 'bitcoin', 'crypto', 'aandelen',
                'weer', 'verkeer', 'ongeval', 'brand',
                'concert', 'film', 'muziek', 'festival'
            ];
            
            // If contains negative keywords, it's likely not football
            if (negativeKeywords.some(keyword => text.includes(keyword))) {
                return false;
            }
            
            return true;
        }

        function deduplicateArticles(articles) {
            const seen = new Set();
            return articles.filter(article => {
                const normalized = normalizeTitle(article.title);
                if (seen.has(normalized)) {
                    return false;
                }
                seen.add(normalized);
                return true;
            });
        }

        function createArticleCard(article) {
            const country = getCountryCode(article);
            const flag = getCountryFlag(country);
            const cleanTitle = cleanTitleForUI(article.title);
            const imageUrl = getImageUrl(article);
            const category = article.category || 'Nieuws';
            const date = formatDate(article.pubDate || article.publishedAt);

            const imageHTML = imageUrl 
                ? `<img src="${imageUrl}" alt="${cleanTitle}" class="article-image" onerror="this.style.display='none'">`
                : '';

            return `
                <a href="/artikel.html?id=${article.id}" class="article-card">
                    ${imageHTML}
                    <div class="article-content">
                        <div class="article-header">
                            ${flag ? `<span class="article-flag">${flag}</span>` : ''}
                        </div>
                        <h3 class="article-title">${cleanTitle}</h3>
                        <div class="article-meta">
                            <span class="article-category">${category}</span>
                            ${date ? `<span>‚Ä¢ ${date}</span>` : ''}
                        </div>
                    </div>
                </a>
            `;
        }

        function sortArticlesByCountry(articles) {
            return articles.sort((a, b) => {
                const countryA = getCountryCode(a);
                const countryB = getCountryCode(b);
                
                // BE and NL first
                if ((countryA === 'BE' || countryA === 'NL') && countryB === 'INT') return -1;
                if (countryA === 'INT' && (countryB === 'BE' || countryB === 'NL')) return 1;
                
                // Then by date
                const dateA = new Date(a.pubDate || a.publishedAt || 0);
                const dateB = new Date(b.pubDate || b.publishedAt || 0);
                return dateB - dateA;
            });
        }

        function renderArticles(articles) {
            const container1 = document.getElementById('articles-container');
            const container2 = document.getElementById('articles-container-2');

            if (!container1) return;

            // Filter, dedupe, and sort
            let filtered = articles.filter(isFootballRelated);
            filtered = deduplicateArticles(filtered);
            filtered = sortArticlesByCountry(filtered);

            // Split articles between two containers
            const firstBatch = filtered.slice(0, 6);
            const secondBatch = filtered.slice(6, 12);

            container1.innerHTML = firstBatch.map(createArticleCard).join('');
            
            if (container2) {
                container2.innerHTML = secondBatch.map(createArticleCard).join('');
            }

            // Initialize AdSense
            if (window.adsbygoogle) {
                const ads = document.querySelectorAll('.adsbygoogle');
                ads.forEach(ad => {
                    try {
                        (adsbygoogle = window.adsbygoogle || []).push({});
                    } catch (e) {
                        console.error('AdSense error:', e);
                    }
                });
            }
        }

        function getCachedArticles() {
            try {
                const cached = localStorage.getItem(CACHE_KEY);
                if (!cached) return null;

                const data = JSON.parse(cached);
                const now = Date.now();
                
                // Check if cache is still valid
                if (now - data.timestamp < CACHE_DURATION) {
                    return data.articles;
                }
            } catch (e) {
                console.error('Cache read error:', e);
            }
            return null;
        }

        function setCachedArticles(articles) {
            try {
                const data = {
                    articles: articles,
                    timestamp: Date.now()
                };
                localStorage.setItem(CACHE_KEY, JSON.stringify(data));
            } catch (e) {
                console.error('Cache write error:', e);
            }
        }

        async function loadArticles() {
            try {
                // Try to load from cache first
                const cached = getCachedArticles();
                if (cached) {
                    renderArticles(cached);
                }

                // Fetch fresh data
                const response = await fetch(`${API_BASE}/api/news?limit=50&ts=${Date.now()}`);
                if (!response.ok) throw new Error('Kon artikelen niet laden');
                
                const data = await response.json();
                const articles = data.articles || data || [];

                // Update cache and render
                setCachedArticles(articles);
                renderArticles(articles);

            } catch (error) {
                console.error('Error loading articles:', error);
                
                // If we have cache, keep showing it
                const cached = getCachedArticles();
                if (cached) {
                    return; // Already rendered from cache
                }

                // Otherwise show error
                const container = document.getElementById('articles-container');
                if (container) {
                    container.innerHTML = `
                        <div class="error">
                            <h3>Fout bij laden van artikelen</h3>
                            <p>${error.message}</p>
                        </div>
                    `;
                }
            }
        }

        // Live banner functionality
        function checkLiveMatches() {
            const banner = document.getElementById('live-banner');
            const text = document.getElementById('live-text');
            
            if (!banner || !text) return;

            fetch(`${API_BASE}/api/live-matches`)
                .then(response => response.json())
                .then(data => {
                    if (data.matches && data.matches.length > 0) {
                        const match = data.matches[0];
                        text.textContent = `LIVE: ${match.homeTeam} vs ${match.awayTeam}`;
                        banner.classList.add('active');
                    }
                })
                .catch(err => console.error('Live matches error:', err));
        }

        // Mobile navigation toggle
        function initMobileNav() {
            const toggle = document.getElementById('nav-toggle');
            const links = document.getElementById('nav-links');
            
            if (toggle && links) {
                toggle.addEventListener('click', () => {
                    links.classList.toggle('active');
                });
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initMobileNav();
            loadArticles();
            checkLiveMatches();
            
            // Refresh articles periodically
            setInterval(loadArticles, REFRESH_MS);
            
            // Check live matches every minute
            setInterval(checkLiveMatches, 60000);
        });
    </script>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-YOUR_PUBLISHER_ID"
            crossorigin="anonymous"></script>
</body>
</html>